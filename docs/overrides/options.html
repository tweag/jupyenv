{% extends "base.html" %}

{% block content %}

  <script type="text/javascript" src = "../javascripts/options.js"></script>
  <link type="text/css" rel="stylesheet" href="../stylesheets/options.css">
  <link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <!-- Add scripts that need to run before here -->
  {{ super() }}
  <!-- Add scripts that need to run afterwards here -->

  <div id="options-content">
    {% include "optionsContent.html" %}
  </div>

  <!-- dynamically load stylesheets if javascript is enabled -->
  <script type="text/javascript">
    //hrefs = [
    //  "https://fonts.googleapis.com/icon?family=Material+Icons",
    //  "../stylesheets/options.css"
    //];
    //hrefs.forEach((href) => {
    //  var link = document.createElement( "link" );
    //  link.href = href;
    //  link.type = "text/css";
    //  link.rel = "stylesheet";

    //  document.getElementsByTagName( "head" )[0].appendChild( link );
    //});
  </script>

  <script type="text/javascript">
    //makeOptionsCollapsible();
    //addExpandCollapseAllButtons();
    //addKernelIcons();

    document.querySelectorAll('.option-button').forEach((button) => {
      button.addEventListener('click', () => {
        const isOpened = button.getAttribute('aria-expanded') === "true";
        if (isOpened ? closeOption(button) : openOption(button));
      });
    });

    document.querySelectorAll('button.toggle-children').forEach((button) => {
      button.addEventListener('click', () => {
        const isOpened = button.getAttribute('aria-expanded') === "true";
        button.parentElement.querySelectorAll('li>div>button.option-button').forEach((childButton) => {
          if (isOpened ? closeOption(childButton) : openOption(childButton));
        });
        button.setAttribute('aria-expanded', !isOpened);
      });
    });

    function openOption(button) {
      button.setAttribute('aria-expanded', "true");
      var content = getNextSibling(button, '.collapsible-content');
      content.setAttribute('state', 'opened');
    }

    function closeOption(button) {
      button.setAttribute('aria-expanded', "false");
      var content = getNextSibling(button, '.collapsible-content');
      content.setAttribute('state', 'closing');

      /* reset toggle children button */
      var toggleChildrenButton = content.querySelector('button.toggle-children');
      if (toggleChildrenButton) {
        toggleChildrenButton.setAttribute('aria-expanded', 'false');
      }

      /* close children too */
      content.querySelectorAll('.option-button').forEach((childButton) => {
        if (childButton.getAttribute('aria-expanded') === "true") {
          closeOption(childButton);
        }
      });

      /* end closing state and hide content */
      content.addEventListener('animationend', () => {
        content.setAttribute('state', 'closed');
      }, {once: true});
    }

    /**
     * credit: https://gomakethings.com/finding-the-next-and-previous-sibling-elements-that-match-a-selector-with-vanilla-js/
     */
    function getNextSibling(elem, selector) {
      // Get the next sibling element
      var sibling = elem.nextElementSibling;

      // If there's no selector, return the first sibling
      if (!selector) return sibling;

      // If the sibling matches our selector, use it
      // If not, jump to the next sibling and continue the loop
      while (sibling) {
        if (sibling.matches(selector)) return sibling;
        sibling = sibling.nextElementSibling
      }
    };
  </script>

{% endblock %}
